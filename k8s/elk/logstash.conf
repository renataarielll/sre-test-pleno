input {
  # Requisito: Input via Beats (Filebeat) [cite: 170]
  beats {
    port => 5044
  }
}

filter {
  # Requisito: Filtro Grok para extrair campos obrigatórios [cite: 171, 178, 179]
  # Exemplo de log esperado: 2025-05-20 INFO /api/v1/users latency=150ms
  grok {
    match => {
      "message" => "%{TIMESTAMP_ISO8601:timestamp} %{LOGLEVEL:level} %{GREEDYDATA:endpoint} latency=%{NUMBER:latency:int}ms"
    }
  }

  # Requisito: Formatação do Timestamp [cite: 177]
  date {
    match => [ "timestamp", "ISO8601" ]
    target => "@timestamp"
  }
}

output {
  # Requisito: Output para Elasticsearch com padrão de índice dinâmico [cite: 149, 172]
  elasticsearch {
    hosts => ["http://elasticsearch:9200"]
    index => "app-logs-%{+YYYY.MM.dd}"
  }
}